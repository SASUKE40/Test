<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>进口周首页动画</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-touch-fullscreen" content="yes">
  <script src="//g.alicdn.com/mtb/lib-flexible/0.3.2/flexible.js" data-mt-inline=""></script>
  <meta name="format-detection" content="telephone=no, email=no">
  <style>
  html,
  body {
    position: absolute;
    height: 100%;
    width: 100%;
    margin: 0;
    overflow: hidden;
  }

  @-webkit-keyframes moto_ios {
    0% {
      -webkit-transform: translate3d(0, 0, 0);
    }
    18.52% {
      -webkit-transform: translate3d(250%, 0, 0);
    }
    20.37% {
      -webkit-transform: translate3d(250%, 180%, 0);
    }
    72.22% {
      -webkit-transform: translate3d(-450%, 180%, 0);
    }
    74.07% {
      -webkit-transform: translate3d(-450%, 0, 0);
    }
    100% {
      -webkit-transform: translate3d(0, 0, 0);
    }
  }

  @-webkit-keyframes moto_android {
    0% {
      -webkit-transform: translate3d(0, 0, 0);
      transform: translate3d(0, 0, 0);
    }
    18.52% {
      -webkit-transform: translate3d(250%, 0, 0);
      transform: translate3d(250%, 0, 0);
    }
    20.37% {
      -webkit-transform: translate3d(250%, 110%, 0);
      transform: translate3d(250%, 110%, 0);
    }
    72.22% {
      -webkit-transform: translate3d(-450%, 110%, 0);
      transform: translate3d(-450%, 110%, 0);
    }
    74.07% {
      -webkit-transform: translate3d(-450%, 0, 0);
      transform: translate3d(-450%, 0, 0);
    }
    100% {
      -webkit-transform: translate3d(0, 0, 0);
      transform: translate3d(0, 0, 0);
    }
  }

  @keyframes moto_android {
    0% {
      -webkit-transform: translate3d(0, 0, 0);
      transform: translate3d(0, 0, 0);
    }
    18.52% {
      -webkit-transform: translate3d(250%, 0, 0);
      transform: translate3d(250%, 0, 0);
    }
    20.37% {
      -webkit-transform: translate3d(250%, 110%, 0);
      transform: translate3d(250%, 110%, 0);
    }
    72.22% {
      -webkit-transform: translate3d(-450%, 110%, 0);
      transform: translate3d(-450%, 110%, 0);
    }
    74.07% {
      -webkit-transform: translate3d(-450%, 0, 0);
      transform: translate3d(-450%, 0, 0);
    }
    100% {
      -webkit-transform: translate3d(0, 0, 0);
      transform: translate3d(0, 0, 0);
    }
  }
  </style>
  <meta content="a1z3i" name="data-spm">
  <meta content="20140614.a1z3i.my0wt4e90" name="data-scm">
  <link type="image/x-icon" href="http://gw.alicdn.com/mt/TB1AElnKVXXXXc8XXXXXXXXXXXX-40-40.jpg" rel="Shortcut Icon">
</head>

<body data-spm="my0wt4e90">
  <script src="//g.alicdn.com/mtb/??lib-windvane/2.0.3/windvane.js,lib-mtop/1.6.4/mtop.js,lib-login/1.4.1/login.js,lib-env/1.5.0/env.js,lib-aa/0.0.16/aa.js,lib-httpurl/1.3.2/httpurl.js,lib-img/0.2.6/img.js,lib-lazyload/2.1.2/lazyload.js,lib-motion/1.0.5/motion.js,lib-gesture/1.1.11/gesture.js," data-mt-inline=""></script>
  <script type="text/javascript">
  /*
   * Tween.js
   * t: current time（当前时间）；
   * b: beginning value（初始值）；
   * c: change in value（变化量）；
   * d: duration（持续时间）。
   * you can visit 'http://easings.net/zh-cn' to get effect
   */
  var Tween = {
    Linear: function(t, b, c, d) {
      return c * t / d + b;
    },
    Quad: {
      easeIn: function(t, b, c, d) {
        return c * (t /= d) * t + b;
      },
      easeOut: function(t, b, c, d) {
        return -c * (t /= d) * (t - 2) + b;
      },
      easeInOut: function(t, b, c, d) {
        if ((t /= d / 2) < 1) return c / 2 * t * t + b;
        return -c / 2 * ((--t) * (t - 2) - 1) + b;
      }
    },
    Cubic: {
      easeIn: function(t, b, c, d) {
        return c * (t /= d) * t * t + b;
      },
      easeOut: function(t, b, c, d) {
        return c * ((t = t / d - 1) * t * t + 1) + b;
      },
      easeInOut: function(t, b, c, d) {
        if ((t /= d / 2) < 1) return c / 2 * t * t * t + b;
        return c / 2 * ((t -= 2) * t * t + 2) + b;
      }
    },
    Quart: {
      easeIn: function(t, b, c, d) {
        return c * (t /= d) * t * t * t + b;
      },
      easeOut: function(t, b, c, d) {
        return -c * ((t = t / d - 1) * t * t * t - 1) + b;
      },
      easeInOut: function(t, b, c, d) {
        if ((t /= d / 2) < 1) return c / 2 * t * t * t * t + b;
        return -c / 2 * ((t -= 2) * t * t * t - 2) + b;
      }
    },
    Quint: {
      easeIn: function(t, b, c, d) {
        return c * (t /= d) * t * t * t * t + b;
      },
      easeOut: function(t, b, c, d) {
        return c * ((t = t / d - 1) * t * t * t * t + 1) + b;
      },
      easeInOut: function(t, b, c, d) {
        if ((t /= d / 2) < 1) return c / 2 * t * t * t * t * t + b;
        return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;
      }
    },
    Sine: {
      easeIn: function(t, b, c, d) {
        return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;
      },
      easeOut: function(t, b, c, d) {
        return c * Math.sin(t / d * (Math.PI / 2)) + b;
      },
      easeInOut: function(t, b, c, d) {
        return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;
      }
    },
    Expo: {
      easeIn: function(t, b, c, d) {
        return (t == 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;
      },
      easeOut: function(t, b, c, d) {
        return (t == d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;
      },
      easeInOut: function(t, b, c, d) {
        if (t == 0) return b;
        if (t == d) return b + c;
        if ((t /= d / 2) < 1) return c / 2 * Math.pow(2, 10 * (t - 1)) + b;
        return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;
      }
    },
    Circ: {
      easeIn: function(t, b, c, d) {
        return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;
      },
      easeOut: function(t, b, c, d) {
        return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;
      },
      easeInOut: function(t, b, c, d) {
        if ((t /= d / 2) < 1) return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;
        return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;
      }
    },
    Elastic: {
      easeIn: function(t, b, c, d, a, p) {
        var s;
        if (t == 0) return b;
        if ((t /= d) == 1) return b + c;
        if (typeof p == "undefined") p = d * .3;
        if (!a || a < Math.abs(c)) {
          s = p / 4;
          a = c;
        } else {
          s = p / (2 * Math.PI) * Math.asin(c / a);
        }
        return -(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;
      },
      easeOut: function(t, b, c, d, a, p) {
        var s;
        if (t == 0) return b;
        if ((t /= d) == 1) return b + c;
        if (typeof p == "undefined") p = d * .3;
        if (!a || a < Math.abs(c)) {
          a = c;
          s = p / 4;
        } else {
          s = p / (2 * Math.PI) * Math.asin(c / a);
        }
        return (a * Math.pow(2, -10 * t) * Math.sin((t * d - s) * (2 * Math.PI) / p) + c + b);
      },
      easeInOut: function(t, b, c, d, a, p) {
        var s;
        if (t == 0) return b;
        if ((t /= d / 2) == 2) return b + c;
        if (typeof p == "undefined") p = d * (.3 * 1.5);
        if (!a || a < Math.abs(c)) {
          a = c;
          s = p / 4;
        } else {
          s = p / (2 * Math.PI) * Math.asin(c / a);
        }
        if (t < 1) return -.5 * (a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;
        return a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p) * .5 + c + b;
      }
    },
    Back: {
      easeIn: function(t, b, c, d, s) {
        if (typeof s == "undefined") s = 1.70158;
        return c * (t /= d) * t * ((s + 1) * t - s) + b;
      },
      easeOut: function(t, b, c, d, s) {
        if (typeof s == "undefined") s = 1.70158;
        return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;
      },
      easeInOut: function(t, b, c, d, s) {
        if (typeof s == "undefined") s = 1.70158;
        if ((t /= d / 2) < 1) return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;
        return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;
      }
    },
    Bounce: {
      easeIn: function(t, b, c, d) {
        return c - Tween.Bounce.easeOut(d - t, 0, c, d) + b;
      },
      easeOut: function(t, b, c, d) {
        if ((t /= d) < (1 / 2.75)) {
          return c * (7.5625 * t * t) + b;
        } else if (t < (2 / 2.75)) {
          return c * (7.5625 * (t -= (1.5 / 2.75)) * t + .75) + b;
        } else if (t < (2.5 / 2.75)) {
          return c * (7.5625 * (t -= (2.25 / 2.75)) * t + .9375) + b;
        } else {
          return c * (7.5625 * (t -= (2.625 / 2.75)) * t + .984375) + b;
        }
      },
      easeInOut: function(t, b, c, d) {
        if (t < d / 2) {
          return Tween.Bounce.easeIn(t * 2, 0, c, d) * .5 + b;
        } else {
          return Tween.Bounce.easeOut(t * 2 - d, 0, c, d) * .5 + c * .5 + b;
        }
      }
    }
  }
  Math.tween = Tween;
  </script>
  <script type="text/javascript">
  var funParabola = function(element, target, options) {
    /*
     * 网页模拟现实需要一个比例尺
     * 如果按照1像素就是1米来算，显然不合适，因为页面动不动就几百像素
     * 页面上，我们放两个物体，200~800像素之间，我们可以映射为现实世界的2米到8米，也就是100:1
     * 不过，本方法没有对此有所体现，因此不必在意
     */

    var defaults = {
      speed: 32, // 每帧移动的像素大小，每帧（对于大部分显示屏）大约16~17毫秒
      curvature: 0.002, // 实际指焦点到准线的距离，你可以抽象成曲率，这里模拟扔物体的抛物线，因此是开口向下的
      progress: function() {},
      complete: function() {}
    };

    var params = {};
    options = options || {};

    for (var key in defaults) {
      params[key] = options[key] || defaults[key];
    }

    var exports = {
      mark: function() {
        return this;
      },
      position: function() {
        return this;
      },
      move: function() {
        return this;
      },
      init: function() {
        return this;
      }
    };

    /* 确定移动的方式
     * IE6-IE8 是margin位移
     * IE9+使用transform
     */
    var moveStyle = "margin",
      testDiv = document.createElement("div");
    if ("oninput" in testDiv) {
      ["", "ms", "webkit"].forEach(function(prefix) {
        var transform = prefix + (prefix ? "T" : "t") + "ransform";
        if (transform in testDiv.style) {
          moveStyle = transform;
        }
      });
    }

    // 根据两点坐标以及曲率确定运动曲线函数（也就是确定a, b的值）
    /* 公式： y = a*x*x + b*x + c;
     */
    var a = params.curvature,
      b = 0,
      c = 0;

    // 是否执行运动的标志量
    var flagMove = true;
    var startTime = Date.now();

    if (element && target && element.nodeType == 1 && target.nodeType == 1) {
      var rectElement = {},
        rectTarget = {};

      // 移动元素的中心点位置，目标元素的中心点位置
      var centerElement = {},
        centerTarget = {};

      // 目标元素的坐标位置
      var coordElement = {},
        coordTarget = {};

      // 标注当前元素的坐标
      exports.mark = function() {
        if (flagMove == false) return this;
        if (typeof coordElement.x == "undefined") this.position();
        element.setAttribute("data-center", [coordElement.x, coordElement.y].join());
        target.setAttribute("data-center", [coordTarget.x, coordTarget.y].join());
        return this;
      }

      exports.position = function() {
        if (flagMove == false) return this;

        var scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft,
          scrollTop = document.documentElement.scrollTop || document.body.scrollTop;

        // 初始位置
        if (moveStyle == "margin") {
          element.style.marginLeft = element.style.marginTop = "0px";
        } else {
          element.style[moveStyle] = "translate(0, 0)";
        }

        // 四边缘的坐标
        rectElement = element.getBoundingClientRect();
        rectTarget = target.getBoundingClientRect();

        // 移动元素的中心点坐标
        centerElement = {
          x: rectElement.left + (rectElement.right - rectElement.left) / 2 + scrollLeft,
          y: rectElement.top + (rectElement.bottom - rectElement.top) / 2 + scrollTop
        };

        // 目标元素的中心点位置
        centerTarget = {
          x: rectTarget.left + (rectTarget.right - rectTarget.left) / 2 + scrollLeft,
          y: rectTarget.top + (rectTarget.bottom - rectTarget.top) / 2 + scrollTop
        };

        // 转换成相对坐标位置
        coordElement = {
          x: 0,
          y: 0
        };
        coordTarget = {
          x: -1 * (centerElement.x - centerTarget.x),
          y: -1 * (centerElement.y - centerTarget.y)
        };

        /*
         * 因为经过(0, 0), 因此c = 0
         * 于是：
         * y = a * x*x + b*x;
         * y1 = a * x1*x1 + b*x1;
         * y2 = a * x2*x2 + b*x2;
         * 利用第二个坐标：
         * b = (y2+ a*x2*x2) / x2
         */
        // 于是
        b = (coordTarget.y - a * coordTarget.x * coordTarget.x) / coordTarget.x;

        return this;
      };

      // 按照这个曲线运动
      exports.move = function() {
        // 如果曲线运动还没有结束，不再执行新的运动
        if (flagMove == false) return this;
        var startx = 0,
          rate = coordTarget.x > 0 ? 1 : -1;
        var now = new Date().getTime()
        var step = function() {
          // 切线 y'=2ax+b
          var tangent = 2 * a * startx + b; // = y / x
          // y*y + x*x = speed
          // (tangent * x)^2 + x*x = speed
          // x = Math.sqr(speed / (tangent * tangent + 1));
          // startx = startx + rate * Math.sqrt(params.speed / (tangent * tangent + 1));
          var time = new Date().getTime() - now
          startx = Tween.Cubic.easeIn(time, startx, rate * Math.sqrt(params.speed / (tangent * tangent + 1)), 1667)
            // debugger

          // 防止过界
          if ((rate == 1 && startx > coordTarget.x) || (rate == -1 && startx < coordTarget.x)) {
            startx = coordTarget.x;
          }
          var x = startx,
            y = a * x * x + b * x;

          // 标记当前位置，这里有测试使用的嫌疑，实际使用可以将这一行注释
          element.setAttribute("data-center", [Math.round(x), Math.round(y)].join());

          // x, y目前是坐标，需要转换成定位的像素值
          if (moveStyle == "margin") {
            element.style.marginLeft = x + "px";
            element.style.marginTop = y + "px";
          } else {
            element.style[moveStyle] = "translate(" + [x + "px", y + "px"].join() + ")";
          }

          if (startx !== coordTarget.x) {
            params.progress(x, y);
            window.requestAnimationFrame(step);
          } else {
            // 运动结束，回调执行
            params.complete();
            flagMove = true;
          }
        };
        window.requestAnimationFrame(step);
        flagMove = false;

        return this;
      };

      // 初始化方法
      exports.init = function() {
        this.position().mark().move();
      };
    }

    return exports;
  };

  (function() {
    var lastTime = 0;
    var vendors = ['webkit', 'moz'];
    for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
      window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
      window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || // name has changed in Webkit
        window[vendors[x] + 'CancelRequestAnimationFrame'];
    }

    if (!window.requestAnimationFrame) {
      window.requestAnimationFrame = function(callback, element) {
        var currTime = new Date().getTime();
        var timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
        var id = window.setTimeout(function() {
          callback(currTime + timeToCall);
        }, timeToCall);
        lastTime = currTime + timeToCall;
        return id;
      };
    }
    if (!window.cancelAnimationFrame) {
      window.cancelAnimationFrame = function(id) {
        clearTimeout(id);
      };
    }
  }());
  </script>
  <script>
  var baseDuration = 80;
  var block = lib.env.os.isIOS ? "TBHomeGridView" : "android.support.v7.widget.AppCompatTextView[text=天猫国际]<<<";
  var start = lib.env.os.isIOS ? "UIImageView[accessibilityLabel=天猫国际]" : "android.support.v7.widget.AppCompatTextView[text=天猫国际]<"

  // 带食物吃的动画
  var fuzzImg = [
    '//gw.alicdn.com/mt/TB1zCFxJVXXXXcFXpXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1UrpiJVXXXXbOXVXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1sD4AJVXXXXbDXpXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1a.0HJVXXXXaTXXXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB13TFeJVXXXXcgXVXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1YARtJVXXXXakXFXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1JgBjJVXXXXX1XVXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1FjViJVXXXXbKXVXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1MstxJVXXXXc_XpXXXXXXXXXX-183-129.gif'
  ].reverse()

  var flagImg = [
    '//g.alicdn.com/mui/flag-img/circle/JP.png',
    '//g.alicdn.com/mui/flag-img/circle/UK.png',
    '//g.alicdn.com/mui/flag-img/circle/US.png',
    '//g.alicdn.com/mui/flag-img/circle/FR.png',
    '//g.alicdn.com/mui/flag-img/circle/AU.png',
    '//g.alicdn.com/mui/flag-img/circle/CN.png',
    '//g.alicdn.com/mui/flag-img/circle/DE.png',
    '//g.alicdn.com/mui/flag-img/circle/TH.png',
    '//g.alicdn.com/mui/flag-img/circle/TW.png'
  ].reverse()

  // 不带食物吃的动画
  var eatingImg = [
    '//gw.alicdn.com/mt/TB1nvdIJVXXXXbCXXXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1wNpnJVXXXXXeXVXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB12GXiJVXXXXcEXVXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1ssNrJVXXXXbmXFXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1OexCJVXXXXaBXpXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1mHdcJVXXXXahaXXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1mDhxJVXXXXauXpXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1EU8uJVXXXXamXFXXXXXXXXXX-183-129.gif',
    '//gw.alicdn.com/mt/TB1t_FlJVXXXXajXVXXXXXXXXXX-183-129.gif'
  ].reverse()

  // 吃前的静态看天图
  // 看天图因为在上线的时候已经默认有了，所以不需要再 track
  // var staticImg = [
  //   '//gw.alicdn.com/mt/TB1UMNJJVXXXXXoXXXXXXXXXXXX-183-129.png',
  //   '//gw.alicdn.com/mt/TB1Q9w.JFXXXXa9XpXXXXXXXXXX-183-129.png',
  //   '//gw.alicdn.com/mt/TB1jbtaJVXXXXa0XpXXXXXXXXXX-183-129.png',
  //   '//gw.alicdn.com/mt/TB1NEUZJFXXXXc6XFXXXXXXXXXX-183-129.png',
  //   '//gw.alicdn.com/mt/TB1QcQYJFXXXXc4XFXXXXXXXXXX-183-129.png',
  //   '//gw.alicdn.com/mt/TB1XLcFJFXXXXauaXXXXXXXXXXX-183-129.png',
  //   '//gw.alicdn.com/mt/TB1EkNeJVXXXXcpXXXXXXXXXXXX-183-129.png',
  //   '//gw.alicdn.com/mt/TB1My76JFXXXXXUXFXXXXXXXXXX-183-129.png',
  //   '//gw.alicdn.com/mt/TB1PnBlJVXXXXXHXXXXXXXXXXXX-183-129.png'
  // ].reverse()

  // 吃完后的满足图
  var satisfiedImg = [
    '//gw.alicdn.com/mt/TB1ss4IJVXXXXcdXXXXXXXXXXXX-183-129.png',
    '//gw.alicdn.com/mt/TB1n1NsJVXXXXaHXFXXXXXXXXXX-183-129.png',
    '//gw.alicdn.com/mt/TB1QyXaJVXXXXbVaXXXXXXXXXXX-183-129.png',
    '//gw.alicdn.com/mt/TB1z2NMJVXXXXalXXXXXXXXXXXX-183-129.png',
    '//gw.alicdn.com/mt/TB14vE.JFXXXXcxaXXXXXXXXXXX-183-129.png',
    '//gw.alicdn.com/mt/TB1HKBoJVXXXXXzXVXXXXXXXXXX-183-129.png',
    '//gw.alicdn.com/mt/TB1qUBgJVXXXXaSXVXXXXXXXXXX-183-129.png',
    '//gw.alicdn.com/mt/TB1NdFLJVXXXXaFXXXXXXXXXXXX-183-129.png',
    '//gw.alicdn.com/mt/TB1aZ8zJVXXXXcMXpXXXXXXXXXX-183-129.png'
  ].reverse()

  // 外卖图标不同状态图
  var waimaiImg = [
    // 没有小车的
    '//gw.alicdn.com/mt/TB1xuanJVXXXXcqXXXXXXXXXXXX-183-129.png',
    // 带刹车动画
    '//gw.alicdn.com/mt/TB1rdikJVXXXXasXpXXXXXXXXXX-183-129.gif',
    // 星星闪
    '//gw.alicdn.com/mt/TB16J1oJVXXXXbMXXXXXXXXXXXX-183-129.gif',
    // 带 HOT 标志
    '//gw.alicdn.com/mt/TB1lPQ.JFXXXXaHaXXXXXXXXXXX-183-129.png'
  ]

  // 摩托图
  var motoImg = '//gw.alicdn.com/mt/TB1ssVjJVXXXXa8XVXXXXXXXXXX-183-129.gif'

  // 1x1 空白gif
  var blankImg = '//gw.alicdn.com/mt/TB19X9vJVXXXXXoXXXXXXXXXXXX-1-1.gif'

  var icons = function() {
    return lib.env.os.isIOS ? [
      "UIImageView[accessibilityLabel=聚划算]",
      "UIImageView[accessibilityLabel=天猫]",
      "UIImageView[accessibilityLabel=充值中心]",
      "UIImageView[accessibilityLabel=阿里旅行]",
      "UIImageView[accessibilityLabel=领金币]",
      "UIImageView[accessibilityLabel=到家]",
      "UIImageView[accessibilityLabel=分类]",
      "UIImageView[accessibilityLabel=天猫超市]",
      "UIImageView[accessibilityLabel=外卖]"
    ] : [
      "android.support.v7.widget.AppCompatTextView[text=聚划算]<",
      "android.support.v7.widget.AppCompatTextView[text=天猫]<",
      "android.support.v7.widget.AppCompatTextView[text=充值中心]<",
      "android.support.v7.widget.AppCompatTextView[text=阿里旅行]<",
      "android.support.v7.widget.AppCompatTextView[text=领金币]<",
      "android.support.v7.widget.AppCompatTextView[text=到家]<",
      "android.support.v7.widget.AppCompatTextView[text=分类]<",
      "android.support.v7.widget.AppCompatTextView[text=天猫超市]<",
      "android.support.v7.widget.AppCompatTextView[text=外卖]<"
    ]
  }();
  icons.reverse()

  PoplayerOperator = {
    trackLayout: function(sel, callback) {
      var me = this
      var mainParams = [{
        selector: sel,
        continuousSelect: true,
        groupId: 'icons',
        operation: {
          name: "poplayerTrack",
          params: {}
        }
      }]
      if (lib.env.os.isAndroid) {
        mainParams.push({
          selector: "com.taobao.tao.homepage.component.HomeSearchView[id=com.taobao.taobao:id/home_search_view]",
          groupId: "top",
          operation: {
            name: "mirror"
          }
        })
      }
      WindVane.call("WVPopLayer", "selectAndOperate", {
        mainParams: mainParams
      }, function(e) {
        callback()
      }, function(e) {});
    },
    getItemSize: function(view, callback) {
      var me = this;
      var id = me.id++;
      if (!me.infos) {
        me.infos = {}
      }
      me.infos[view + "_" + id] = callback;
      WindVane.call("WVPopLayer", "selectAndOperate", {
        mainParams: [{
          selector: view,
          taskHandle: view + "_" + id,
          continuousSelect: false,
          operation: {
            name: 'info'
          }
        }]
      }, function() {}, function(e) {
        alert(JSON.stringify(e))
      })
    },
    __info: function(e) {
      var me = this;
      var taskId = e.param.taskHandle;
      var fn = me.infos[taskId];
      if (fn) {
        if (e.param.succeed) {
          fn(e.param.info)
        } else {
          fn({})
        }
        delete me.infos[taskId];
      }
    },
    id: 100,
    listen: function() {
      var me = this;
      document.addEventListener("PopLayer.SOTask.Track", function(e) {
        //alert("Error" + JSON.stringify(e))
      }, false)
      document.addEventListener("PopLayer.SOTask.Info", function(e) {
        //document.write(JSON.stringify(e))
        me.__info(e);
      }, false)
    },
    display: function() {
      window.WindVane.call('WVPopLayer', 'display', {},
        function(s) {},
        function(e) {});
    },
    track: function(sel, imgUrl) {
      if (lib.env.os.isIOS || lib.env.os.isAndroid) {
        var mainParams = [{
          selector: sel,
          operation: {
            name: imgUrl.length ? 'track' : "untrack",
            params: {
              imgUrl: imgUrl,
              modalThreshold: 0,
              imgFillMode: "ScaleAspectFit"
            }
          }
        }]
        WindVane.call("WVPopLayer", "selectAndOperate", {
          mainParams: mainParams
        });
      } else {
        if (imgUrl.length) {
          PoplayerOperator.trackDom(sel, imgUrl);
        }
      }
    },
    renderDom: function(sel, imgUrl, callback) {
      var me = this;
      me.getItemSize(sel, function(e) {
        if (typeof e === 'string') {
          e = JSON.parse(e)
        }
        // 如果超出视野范围就关闭动画
        if (typeof e.height === 'undefined') {
          window.WindVane.call('WVPopLayer', 'close', {})
        }

        var blockData = me.trackData.block
        var selData = me.trackData[sel]
        var cp = me.trackData.cp
          // top 自己算
        var top = function() {
          var baseTop = 8.3 * (selData.width / 44) * cp
          var index = icons.indexOf(sel)
            // 如果是第一排 icon
          if (index === 0 || index > 5) {
            return baseTop
          }
          // 如果不在 icons 里，就是 start
          else if (index === -1)
            return baseTop
              // 如果是第二排 icon
          else {
            //alert( baseTop + "\t" + selData.height * cp )
            return 14.6 * (selData.width / 44) * cp + selData.height * cp
          }
        }()

        var div = document.createElement('div')
        div.style.cssText = [
          'position: absolute',
          'z-index:' + (me.id++),
          'height:' + (selData.height * cp) + 'px',
          'width:' + (selData.width * cp) + 'px',
          'left:' + ((selData.x - blockData.x) * cp) + 'px',
          // 'top:' + ((selData.y - blockData.y) * cp) + 'px'
          'top:' + (top) + 'px'
        ].join(';')
        div.innerHTML = '<img src="' + imgUrl + '" width="100%">'
        document.body.appendChild(div)
        if (callback) {
          callback(div)
        }
      })

      // me.getItemSize( block ,function( tv ){
      //   if( typeof tv === "string" ){
      //       tv = JSON.parse( tv );
      //   }
      //   var realScreenWidth = tv.width ;
      //   var baseRealTop = tv.y ;
      //   var baseRealLeft = tv.x;
      //   var renderScreenWidth = document.documentElement.clientWidth ;
      //   var cp = renderScreenWidth / realScreenWidth;
      //   // me.cp = cp
      //   me.getItemSize( sel  ,function( e ){
      //     if( typeof e === "string" ){
      //       e = JSON.parse( e );
      //     }
      //     if( e.height === undefined ){
      //       //超出视野区域了，不再渲染。
      //       //先关掉动画，下次再显示。
      //       window.WindVane.call('WVPopLayer', 'close', {}, function(e){
      //        }, function(e) {
      //                 // do something when failed;
      //        });
      //     }
      //     var tmLeft  = e.x ;
      //     //var cp = PoplayerOperator.cp;
      //     var top=  3 * ( e.width / 44 )
      //     var div = document.createElement("div");
      //     div.style.cssText = "height:" + e.height * cp + "px;width:" + e.width * cp + "px;position:absolute;top:" + ( e.y - baseRealTop ) * cp + "px;left:" + ( e.x - baseRealLeft ) * cp + "px";
      //     div.innerHTML = "<img src='"+ imgUrl  +"' width='100%'>";
      //     div.style.zIndex = PoplayerOperator.id ++;
      //     //div.setAttribute( "sel" , sel );
      //     document.body.appendChild( div );
      //     if(callback){
      //       callback( div );
      //     }
      //   });
      // });
    },
    trackDom: function(sel, imgUrl, callback) {
      var ele = document.querySelector("[sel='" + sel + "'] > img ");
      if (!ele) {
        PoplayerOperator.renderDom(sel, imgUrl, function(div) {
          div.setAttribute("sel", sel);
          ele = div;
          if (callback) {
            callback(div);
          }
        });
      } else {
        ele.src = imgUrl;
        if (callback) {
          callback(ele);
        }
      }
    },
    showFlag: function(sel, imgFlag) {
      var me = this
      me.trackDom(sel, '')
      me.trackDom(sel, imgFlag)

    },
    showFuzz: function(sel, imgFuzz, imgEating) {
      var me = this;
      me.track(sel, "");
      me.track(sel, imgFuzz);

      setTimeout(function() {
        me.track(sel, "");
        me.track(sel, imgEating);
      }, 1400);
    },
    satisfied: function() {
      var me = this;
      icons.forEach(function(sel, index) {
        me.track(sel, "")
        me.track(sel, satisfiedImg[index])
      })
    },
    correctPos: function() {
      var me = this
      var sels = [start].concat(icons)
      var cp = me.trackData.cp
      setTimeout(function() {
        me.getItemSize(block, function(tv) {
          if (typeof tv === 'string') {
            tv = JSON.parse(tv)
          }
          sels.forEach(function(sel, i) {
            me.getItemSize(sel, function(e) {
              if (typeof e === 'string') {
                e = JSON.parse(e)
              }
              var dom = document.querySelector('[sel="' + sel + '"]')
              if (dom) {
                dom.style.top = (e.y - tv.y) * cp + 'px'
              }
              // 同时修正小车
              if (i === 1) {
                me.moto.style.top = (e.y - tv.y) * cp + 'px'
              }

              // 最后一个 item 算完后，再重新倒计时订正
              // if (i === sels.length - 1 && !me.finished) {
              //   me.correctPos()
              // }
            })
          })
        })
      }, 500)
    },
    initTrackData: function(callback) {
      var me = this
      var trackData = {}
      me.getItemSize(block, function(tv) {
        if (typeof tv === 'string') {
          tv = JSON.parse(tv)
        }
        trackData.block = tv

        var renderScreenWidth = document.documentElement.clientWidth;
        trackData.cp = renderScreenWidth / tv.width

        var count = 0
        var sels = [].concat(icons).concat([start])
        sels.forEach(function(sel) {
          me.getItemSize(sel, function(e) {
            if (typeof e === 'string') {
              e = JSON.parse(e)
            }
            trackData[sel] = e
            count++
            if (count === icons.length) {
              me.trackData = trackData
              callback()
            }
          })
        })
      })
    }
  }

  // 不在这里加 class，是因为小车要先显示出来后，再切成动画，如果现在加了 class，马上就会有动画了
  // document.body.classList.add( lib.env.os.isIOS ? "IOS" : "ANDROID");
  PoplayerOperator.trackLayout(block, function() {
    PoplayerOperator.listen();
    PoplayerOperator.display();

    var count = 9;
    var current = 0;

    function showFuzz() {
      // 从外卖的下一个 icon 开始计算
      for (var i = 0, step, duration; i < 9; i++) {
        // 第一排右侧
        if (i === 0) {
          step = 4
        }
        // 第二排
        else if (i <= 5) {
          step = 13
        }
        // 第一排左侧
        else {
          step = 22
        }
        duration = baseDuration * (i * 4 + step)

        setTimeout(function(i) {
          // 为了保存 i 需要通过函数保存
          return function() {
            PoplayerOperator.showFuzz(icons[i], fuzzImg[i], eatingImg[i])
          }
        }(i), duration)
      }
    }

    function showFlag() {
      for (var i = 0; i < 9; i++) {
        PoplayerOperator.showFlag(icons[i], flagImg[i]);
      }
    }

    function startGame() {
      // 进入后先将所有的图片 track 一遍，从而可以算好位置，否则位置会出错
      icons.forEach(function(icon, index) {
        PoplayerOperator.track(icon, blankImg)
      });
      PoplayerOperator.track(start, blankImg)

      PoplayerOperator.renderDom(start, motoImg, function(div) {
        PoplayerOperator.moto = div
        div.style.zIndex = '9999'
        div.style.display = 'block'
        div.style.overflow = 'hidden'

        // div.className = "item";
        var delay = 500;
        setTimeout(function() {
          // 添加 class 开始动画
          // document.body.classList.add( lib.env.os.isIOS ? "IOS" : "ANDROID");
          // 一定要用 js 加，否则某些 android 下无效
          var animationName = lib.env.os.isIOS ? 'moto_ios' : 'moto_android'
          div.style.webkitAnimation = animationName + ' 4640ms linear'

          // 将外卖图片换成没有小车的
          PoplayerOperator.track(start, waimaiImg[0])

          // 依次显示吃的动画
          // showFuzz();
          showFlag()

          // android 下需要每订正位置
          // if (!lib.env.os.isIOS) {
          //   PoplayerOperator.correctPos()
          // }
        }, delay);
        PoplayerOperator.renderDom(start, motoImg, function(div) {
          div.setAttribute('id', 'target')
        })

        setTimeout(function() {

          var elements = document.getElementsByTagName("div"),
            target = document.getElementById("target");
          // 抛物线元素的的位置标记
          var parabola = [];
          for (var i = 0, len = elements.length; i < len; i++) {

            var ani = funParabola(elements[i], target).mark()
            parabola.push(ani)
          }
          // 抛物线运动的触发
          // document.body.onclick = function() {
          // element.style.marginLeft = "0px";
          // element.style.marginTop = "0px";
          for (var i = 0, len = parabola.length; i < len; i++) {
            parabola[i].init()
          }
          // };
        }, delay + 1000)

        // 换小车方向，默认向右
        setTimeout(function() {
          // 换成向左
          div.querySelector("img").style.webkitTransform = 'scaleX(-1)'
        }, delay + 11 * baseDuration);
        setTimeout(function() {
          // 换回向右
          div.querySelector("img").style.webkitTransform = ''
        }, delay + 41 * baseDuration);

        // 将外卖图标换成刹车动画
        setTimeout(function() {
          // 不需要先清空，否则会导致露出底图
          // PoplayerOperator.track(start, "");
          PoplayerOperator.track(start, waimaiImg[1])
        }, delay + 54 * baseDuration);
        // 移除骑车人
        setTimeout(function() {
          document.body.removeChild(div)
        }, delay + 58 * baseDuration);
        // 外卖图标换成星星闪的动画
        setTimeout(function() {
            PoplayerOperator.track(start, "");
            PoplayerOperator.track(start, waimaiImg[2]);
          }, delay + 54 * baseDuration + 1000)
          // 外卖图标换成带 HOT 的版本，同时将所有动画关闭
        setTimeout(function() {
          PoplayerOperator.track(start, "");
          PoplayerOperator.track(start, waimaiImg[3]);
          PoplayerOperator.satisfied()
          PoplayerOperator.finished = true
          window.WindVane.call('WVPopLayer', 'increaseReadTimes', {})
        }, delay + 54 * baseDuration + 1000 + 1000);
        setTimeout(function() {
          PoplayerOperator.track(start, '')
          for (var i = 0; i < 9; i++) {
            PoplayerOperator.track(icons[i], '');
          }
        }, delay + 54 * baseDuration + 1000 + 1000 + 1000)
      });
    }



    // 先把图片都预加载，再开始游戏
    var preloadMap = {}
    var preloadCount = 0
    var imageUrls = [].concat(fuzzImg).concat(eatingImg).concat(satisfiedImg)
      .concat(waimaiImg).concat([motoImg, blankImg])
      //.concat(staticImg)

    function finishChecker() {
      if (preloadCount === imageUrls.length) {
        PoplayerOperator.initTrackData(startGame)
          // startGame()
      }
    }

    function preloadImg(url) {
      var img = new Image

      img.onload = function() {
        preloadCount++
        img = null
        finishChecker()
      }
      img.onerror = function() {
        preloadMap[url]++
          img = null

        // 图片失败 3 次，则跳过
        if (preloadMap[url] <= 3) {
          preloadImg(url)
        } else {
          preloadCount++
          finishChecker()
        }
      }
      img.src = url
    }

    imageUrls.map(function(url) {
      preloadMap[url] = 0
      return url
    }).forEach(function(url) {
      preloadImg(url)
    })
  });
  </script>
  <script src="//g.alicdn.com/alilog/??wlog/0.2.8/aplus_wap.js,wlog/0.2.8/spm_wap.js,wlog/0.2.8/spmact_wap.js"></script>
</body>

</html>
